# Enable error display for debugging (disable in production)
php_flag display_errors on
php_value error_reporting E_ALL

# Set default charset
php_value default_charset "UTF-8"

# Disable directory browsing
Options -Indexes

# Enable URL rewriting
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Ensure trailing slash on directories
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_URI} !(.*)/$
    RewriteRule ^(.*)$ /$1/ [L,R=301]
    
    # Handle direct file requests
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^ - [L]
    
    # Handle static assets
    RewriteCond %{REQUEST_URI} ^/(assets|uploads|chapters)/
    RewriteRule ^ - [L]
</IfModule>

# Protect sensitive files
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

<FilesMatch "\.(json|log|md)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Allow access to specific directories
<Directory "data">
    Order deny,allow
    Deny from all
</Directory>

# Security headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
</IfModule>

# GZIP compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>
